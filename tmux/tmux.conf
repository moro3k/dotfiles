# Zellij-like tmux config

# --- Базовые ---
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g history-limit 50000
set -sg escape-time 0
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g status-interval 1

# --- Prefix bindings ---
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# --- Ctrl+p → Pane ---
bind -n C-p switch-client -T pane
bind -T pane d     "split-window -v -c '#{pane_current_path}'; switch-client -T pane"
bind -T pane r     "split-window -h -c '#{pane_current_path}'; switch-client -T pane"
bind -T pane x     kill-pane
bind -T pane f     "resize-pane -Z; switch-client -T pane"
bind -T pane Left  "select-pane -L; switch-client -T pane"
bind -T pane Right "select-pane -R; switch-client -T pane"
bind -T pane Up    "select-pane -U; switch-client -T pane"
bind -T pane Down  "select-pane -D; switch-client -T pane"
bind -T pane h     "select-pane -L; switch-client -T pane"
bind -T pane l     "select-pane -R; switch-client -T pane"
bind -T pane k     "select-pane -U; switch-client -T pane"
bind -T pane j     "select-pane -D; switch-client -T pane"
bind -T pane e     "select-layout even-horizontal; switch-client -T pane"
bind -T pane E     "select-layout even-vertical; switch-client -T pane"
bind -T pane Escape switch-client -T root
bind -T pane Enter  switch-client -T root

# --- Ctrl+t → Tab ---
bind -n C-t switch-client -T tab
bind -T tab n     "new-window -c '#{pane_current_path}'; switch-client -T tab"
bind -T tab x     kill-window
bind -T tab r     command-prompt -I '#W' 'rename-window %%'
bind -T tab Left  "previous-window; switch-client -T tab"
bind -T tab Right "next-window; switch-client -T tab"
bind -T tab h     "previous-window; switch-client -T tab"
bind -T tab l     "next-window; switch-client -T tab"
bind -T tab Tab   "last-window; switch-client -T tab"
bind -T tab 1     "select-window -t 1; switch-client -T tab"
bind -T tab 2     "select-window -t 2; switch-client -T tab"
bind -T tab 3     "select-window -t 3; switch-client -T tab"
bind -T tab 4     "select-window -t 4; switch-client -T tab"
bind -T tab 5     "select-window -t 5; switch-client -T tab"
bind -T tab Escape switch-client -T root
bind -T tab Enter  switch-client -T root

# --- Ctrl+o → Session ---
bind -n C-o switch-client -T session
bind -T session d detach-client
bind -T session w choose-tree -s
bind -T session r command-prompt 'rename-session %%'
bind -T session Escape switch-client -T root
bind -T session Enter  switch-client -T root

# --- Alt+1..5 → переключение/создание табов ---
bind -n M-1 if-shell 'tmux select-window -t 1' '' 'new-window -t 1 -c "#{pane_current_path}"'
bind -n M-2 if-shell 'tmux select-window -t 2' '' 'new-window -t 2 -c "#{pane_current_path}"'
bind -n M-3 if-shell 'tmux select-window -t 3' '' 'new-window -t 3 -c "#{pane_current_path}"'
bind -n M-4 if-shell 'tmux select-window -t 4' '' 'new-window -t 4 -c "#{pane_current_path}"'
bind -n M-5 if-shell 'tmux select-window -t 5' '' 'new-window -t 5 -c "#{pane_current_path}"'

# --- Русская раскладка (дубли) ---
bind -n C-з switch-client -T pane
bind -n C-е switch-client -T tab
bind -n C-щ switch-client -T session
bind -n C-п source-file ~/.config/tmux/lock.conf

# Внутри режимов: русские дубли клавиш
bind -T pane в     "split-window -v -c '#{pane_current_path}'; switch-client -T pane"
bind -T pane к     "split-window -h -c '#{pane_current_path}'; switch-client -T pane"
bind -T pane ч     kill-pane
bind -T pane а     "resize-pane -Z; switch-client -T pane"
bind -T pane р     "select-pane -L; switch-client -T pane"
bind -T pane д     "select-pane -R; switch-client -T pane"
bind -T pane л     "select-pane -U; switch-client -T pane"
bind -T pane о     "select-pane -D; switch-client -T pane"
bind -T pane у     "select-layout even-horizontal; switch-client -T pane"
bind -T pane У     "select-layout even-vertical; switch-client -T pane"

bind -T tab т     "new-window -c '#{pane_current_path}'; switch-client -T tab"
bind -T tab ч     kill-window
bind -T tab к     command-prompt -I '#W' 'rename-window %%'
bind -T tab р     "previous-window; switch-client -T tab"
bind -T tab д     "next-window; switch-client -T tab"

bind -T session в detach-client
bind -T session ц choose-tree -s
bind -T session к command-prompt 'rename-session %%'

# --- Ctrl+g → Lock/Unlock ---
bind -n C-g source-file ~/.config/tmux/lock.conf

# --- Статусбар ---
set -g status-position bottom
set -g status-style "bg=colour235,fg=white"
set -g status-left " "
set -g status-left-length 5
set -g status-right-length 200

setw -g window-status-separator ""
setw -g window-status-format "#[bg=colour238#,fg=colour245] #W #[bg=colour235] "
setw -g window-status-current-format "#[bg=colour130#,fg=black#,bold] #W #[bg=colour235#,nobold] "

set -g status-right "\
#[align=centre]\
#{?#{==:#{client_key_table},pane},\
#[bg=colour130#,fg=black#,bold] PANE #[bg=colour235#,nobold] \
#[fg=colour130#,bold]d#[fg=colour245#,nobold] ↓ \
#[fg=colour130#,bold]r#[fg=colour245#,nobold] → \
#[fg=colour130#,bold]x#[fg=colour245#,nobold] ✕ \
#[fg=colour130#,bold]f#[fg=colour245#,nobold] zoom \
#[fg=colour130#,bold]←→#[fg=colour245#,nobold] nav \
#[fg=colour245]Esc\
,#{?#{==:#{client_key_table},tab},\
#[bg=colour130#,fg=black#,bold] TAB #[bg=colour235#,nobold] \
#[fg=colour130#,bold]n#[fg=colour245#,nobold] new \
#[fg=colour130#,bold]x#[fg=colour245#,nobold] ✕ \
#[fg=colour130#,bold]r#[fg=colour245#,nobold] ren \
#[fg=colour130#,bold]←→#[fg=colour245#,nobold] sw \
#[fg=colour130#,bold]1-5#[fg=colour245#,nobold] go \
#[fg=colour245]Esc\
,#{?#{==:#{client_key_table},session},\
#[bg=colour130#,fg=black#,bold] SESS #[bg=colour235#,nobold] \
#[fg=colour130#,bold]d#[fg=colour245#,nobold] det \
#[fg=colour130#,bold]w#[fg=colour245#,nobold] list \
#[fg=colour130#,bold]r#[fg=colour245#,nobold] ren \
#[fg=colour245]Esc\
,\
#[fg=colour130#,bold]g#[fg=colour245#,nobold] lock \
#[fg=colour130#,bold]p#[fg=colour245#,nobold] pane \
#[fg=colour130#,bold]t#[fg=colour245#,nobold] tab \
#[fg=colour130#,bold]o#[fg=colour245#,nobold] sess\
}}}\
#[align=right]#[fg=colour245]#(~/.config/tmux/kbd-layout.sh) #[fg=colour240]│ #[fg=colour245]%H:%M "

# --- Плагины (TPM) ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-yank'
run '~/.tmux/plugins/tpm/tpm'
